[gd_scene load_steps=7 format=2]

[ext_resource path="res://player/player.tscn" type="PackedScene" id=1]
[ext_resource path="res://world/world.gd" type="Script" id=2]
[ext_resource path="res://world/chunk/chunk.tscn" type="PackedScene" id=3]

[sub_resource type="Shader" id=3]
code = "shader_type spatial;

uniform sampler2D player_path;
uniform ivec2 height_map_size;
uniform float default_height;
uniform int vertex_density;

float height(vec2 position) {
	position.x += float(height_map_size.x) / 2.0;
	position.y += float(height_map_size.y) / 2.0;
	position *= float(vertex_density);
	if (int(position.y) >= height_map_size.y * vertex_density || int(position.y) < 0) {
		return default_height - 0.075;
	}
	float val = texelFetch(player_path, ivec2(int(position.x), int(position.y)), 0).r;
	return val * 2.0;
}

void vertex() {
	VERTEX.y = height(VERTEX.xz);
	vec2 e = vec2(0.3, 0.0);
	vec3 normal = normalize(vec3(height(VERTEX.xz - e) - height(VERTEX.xz + e), 2.0 * e.x, height(VERTEX.xz - e.yx) - height(VERTEX.xz + e.yx)));
	NORMAL = normal;
}

"

[sub_resource type="ShaderMaterial" id=5]
shader = SubResource( 3 )
shader_param/height_map_size = PoolIntArray( 40, 60 )
shader_param/default_height = 0.5
shader_param/vertex_density = 4.0

[sub_resource type="ShaderMaterial" id=6]
shader = SubResource( 3 )
shader_param/height_map_size = PoolIntArray( 40, 60 )
shader_param/default_height = 0.5
shader_param/vertex_density = 4.0

[node name="World" type="Spatial"]
script = ExtResource( 2 )

[node name="Chunk" parent="." instance=ExtResource( 3 )]

[node name="Snow" parent="Chunk" index="2"]
material_override = SubResource( 5 )

[node name="Chunk2" parent="." instance=ExtResource( 3 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -70 )

[node name="Snow" parent="Chunk2" index="2"]
material_override = SubResource( 6 )

[node name="Player" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.49558, 0 )

[node name="Camera" type="Camera" parent="."]
transform = Transform( 1, 0, 0, 0, 0.610194, 0.792252, 0, -0.792252, 0.610194, 0, 18.2701, 19.7697 )
current = true
size = 50.0

[editable path="Chunk"]

[editable path="Chunk2"]
